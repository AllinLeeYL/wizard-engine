def num_environ_buf = Array<int>.new(1);
def size_environ_buf = Array<int>.new(1);

// allocate the buffer to store the environment variables
def environ_p_buf = Array<Pointer>.new(num_environ);
def environ_buf = Array<byte>.new(size_environ);

def main() -> int {
    def num_environ_p = Pointer.atContents(num_environ_buf);
    def size_environ_p = Pointer.atContents(size_environ_buf);

    wasi_snapshot_preview1.environ_sizes_get(num_environ_p, size_environ_p);
    if (num_environ_buf[0] != 2 || size_environ_buf[0] != 16) {
        return 1;
    }

    def num_environ = num_environ_buf[0];
    def size_environ = size_environ_buf[0];


    // get the pointer to buffers
    def environ_p_buf_p = Pointer.atContents(environ_p_buf);
    def environ_buf_p = Pointer.atContents(environ_buf);

    // call environ_get
    wasi_snapshot_preview1.environ_get(environ_p_buf_p, environ_buf_p);

    System.puts(environ_buf);
    System.ln();

    return 0;
}